/*
 * Copyright (c) 2022, Connect Tech Inc.  All rights reserved.
 *
 * This program is free software; you can redistribute it and/or modify it
 * under the terms and conditions of the GNU General Public License,
 * version 2, as published by the Free Software Foundation.
 *
 * This program is distributed in the hope it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for
 * more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

#include "tegra234-orin-nx-cti-base.dtsi"

/{
    nvidia,dtsfilename = "tegra234-orin-nx-cti-NGX012.dts";
    
    
    display@13800000 {
            status = "disabled";
    };

    mttcan@c310000 {
            status = "disabled";
    };

//Note USB3 P1 is only on ORIN-NX regular nx variety will only have 1 usb!
    fixed-regulators{
        /delete-node/ cti_usb_vbus;
        cti_hadron_vbus1: regulator@201 {
            compatible = "regulator-fixed";
            reg=<201>;
            regulator-name = "cti-hadron-vbus1";
            regulator-min-microvolt = <5000000>;
            regulator-max-microvolt = <5000000>;
            gpio = <&tegra_main_gpio TEGRA234_MAIN_GPIO(P, 6) 0>;
            enable-active-high;
            regulator-boot-on;
            regulator-always-on;
        };
        cti_hadron_vbus2: regulator@202 {
            compatible = "regulator-fixed";
            reg=<202>;
            regulator-name = "cti-hadron-vbus1";
            regulator-min-microvolt = <5000000>;
            regulator-max-microvolt = <5000000>;
            gpio = <&tegra_aon_gpio TEGRA234_AON_GPIO(CC, 2) 0>;
            enable-active-high;
            regulator-boot-on;
            regulator-always-on;
        };

    };

    pwm@3280000 {/* PWM1 40pin header, pin 15 */
        status = "okay";
    };
  
    pwm@32c0000 {/* PWM5 40 pin header, pin 33 */
        status = "disabled";
    };

    spi@3210000{
        status="okay";
    };

    spi@3230000{
        status="disabled";
    };


    //serial
    serial@3100000 { // /dev/ttyTHS0 pinUART1
        status = "okay";
    };

    serial@3110000 {//uart0
        /* UARTB */
        status = "okay";
    };

    serial@31d0000 {/* UARTI - SBSA */
        status = "okay";
    };

};

&xusb_padctl{
    status = "okay";
    pads {
        usb2 {
            lanes {
                usb2-0 {
                    nvidia,function = "xusb";
                    vbus-supply = <&cti_hadron_vbus1>;
                    status = "okay";
                };
                usb2-1 {
                    nvidia,function = "xusb";
                    vbus-supply = <&cti_hadron_vbus2>;
                    status = "okay";
                };
                usb2-2 {
                    nvidia,function = "xusb";
                    status = "okay";
                };
            };
        };
        usb3 {
            lanes {
                usb3-0 {
                    nvidia,function = "xusb";
                    status = "okay";
                };
                usb3-1 {
                    nvidia,function = "xusb";
                    status = "okay";
                };               
            };
        };
    };

    ports {
        /delete-node/ usb2-0;
        usb2-0 {
            mode = "host";
            status = "okay";
            vbus-supply = <&cti_hadron_vbus1>;
          //  usb-role-switch;
          //  /delete-node/ connector;
          // connector {
                /* NOTE: PN: While the Physical connector is Type-C we are using the
                 * microUSB driver as the HW uses the older OTG_ID/VBUS_DET gpio
                 * for indicating role switchs
                 */
          //      compatible = "gpio-usb-b-connector", "usb-b-connector";
          //      label = "micro-USB";
         ///       type = "micro";
         ///       vbus-gpios = <&tegra_main_gpio TEGRA234_MAIN_GPIO(Z, 1) GPIO_ACTIVE_HIGH>;
                //Note EE.02 is a normal gpio on hadron
                //id-gpios = <&tegra_aon_gpio TEGRA234_AON_GPIO(EE, 2) GPIO_ACTIVE_HIGH>;
         //   };

        };
        usb2-1 {
            mode = "host";
            vbus-supply = <&cti_hadron_vbus2>;
            status = "okay";
        };
        usb2-2 {/* Goes to M2.E */
            mode = "host";
            vbus-supply = <&vdd_5v_sys>;
            status = "okay";
        };
        usb3-0 { /* Goes to OTG */
            nvidia,usb2-companion = <0>;
            status = "okay";
        };
        usb3-1 {/* Goes to host USB */
            nvidia,usb2-companion = <1>;
            status = "okay";
        };

    };


};

&tegra_xudc{
        status = "okay";
        phys = <&{/xusb_padctl@3520000/pads/usb2/lanes/usb2-0}>,
            <&{/xusb_padctl@3520000/pads/usb3/lanes/usb3-0}>;
        phy-names = "usb2-0", "usb3-0";
        nvidia,xusb-padctl = <&xusb_padctl>;
};

&tegra_xhci{
        status = "okay";
        phys = <&{/xusb_padctl@3520000/pads/usb2/lanes/usb2-0}>,
            <&{/xusb_padctl@3520000/pads/usb2/lanes/usb2-1}>,
            <&{/xusb_padctl@3520000/pads/usb2/lanes/usb2-2}>,
            <&{/xusb_padctl@3520000/pads/usb3/lanes/usb3-0}>,
            <&{/xusb_padctl@3520000/pads/usb3/lanes/usb3-1}>;
        phy-names = "usb2-0", "usb2-1", "usb2-2", "usb3-0", "usb3-1";
        nvidia,xusb-padctl = <&xusb_padctl>;

};

